/* ********************************************************
**
** PC DEVICE_REDIRECT.JS
** PCファイル用 （SMP画面 → SMP用URLに切り替わる）
**
******************************************************** */

var swichSP = function(){
	var spFlg,cntDir,cntDirLen,cntDirLink;
	var anchor = '';
	var locUrl = encodeURI(decodeURI(location.href));
	var UA = navigator.userAgent;
	var cntPath;
	var i;
	cntDir = locUrl.split('~');
	cntDirLen = cntDir.length;
	cntDirLink = cntDir[cntDirLen - 1];
	if(cntDirLink.indexOf('#') != -1){
		anchor = cntDirLink.match(/#.*/g);
		cntDirLink = cntDirLink.replace(/#.*/g, '');
	}
	if(cntDirLink.indexOf('?original=1') == -1 && cntDirLink.indexOf('&original=1') == -1){
		if(cntDirLink.indexOf('?') == -1){
			if(cntDirLink.indexOf('&') != -1){
				cntDirLink = cntDirLink + '&original=1';
			} else {
				cntDirLink = cntDirLink + '?original=1';
			}
		} else {
			cntDirLink = cntDirLink.replace('?', '?original=1&');
		}
	}
	//ユーザエージェント判定
	if ((UA.indexOf('iPhone') > 0 && UA.indexOf('iPad') == -1) && !mp_env.isFromApp || UA.indexOf('iPod') > 0 || UA.indexOf('Android') > 0 && !mp_env.isFromApp || UA.indexOf('Tizen') > 0 || mp_env.isFromApp) {
		var ckAry = document.cookie.split(';');
		for(i = 0; i < ckAry.length; i++){
			if( ckAry[i].indexOf('sp') !== -1){
				var str = ckAry[i].split('=');
				if(str[0].replace(/^\s+/, "")=='sp'){
					spFlg = (str[1]==1)?'sp_1':'sp_0';
				}
			}
		}
		if(spFlg!=='sp_0'){
			for (i=1; i<=cntDirLen-2; i++){
				cntPath = (cntPath == undefined) ? '~' + cntDir[i] : cntPath + '~' + cntDir[i];
			}
			location.href = cntDir[0] + cntPath + '~smp~' + cntDirLink + anchor;
			return false;
		}
	}
};
swichSP();